<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gesti√≥n de proyectos ¬∑ Offline</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f8fafc;--panel:#fff;--ink:#0f172a;--muted:#475569;--border:#e2e8f0;--accent:#2563eb}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  header{padding:16px 20px;border-bottom:1px solid var(--border);background:var(--panel);position:sticky;top:0;z-index:10}
  header h1{margin:0;font-size:18px;font-weight:600}
  .app{display:grid;grid-template-columns:2fr 1fr;gap:16px;padding:16px;max-width:1400px;margin:0 auto}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
  #calendar{min-height:72vh}
  .tasks-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .tasks-head h2{font-size:16px;margin:0}
  .badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#eef2ff;border:1px solid #e0e7ff}
  .task-card{border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px}
  .task-title{display:flex;justify-content:space-between;gap:8px;font-weight:600}
  .task-meta{display:flex;flex-wrap:wrap;gap:12px;color:var(--muted);font-size:12px;margin-top:6px}
  .progress-bar{background:#f1f5f9;height:8px;border-radius:999px;margin-top:8px;overflow:hidden}
  .progress-bar>span{display:block;height:100%;background:var(--accent)}
  footer{text-align:center;color:var(--muted);font-size:12px;padding:12px 0 24px}
  @media (max-width:960px){.app{grid-template-columns:1fr}#calendar{min-height:50vh}}
</style>
</head>
<body>
<header><h1>üìÖ Gesti√≥n de proyectos ¬∑ Prototipo (offline)</h1></header>

<main class="app">
  <section class="card"><div id="calendar"></div></section>
  <aside class="card">
    <div class="tasks-head"><h2>Tareas asignadas</h2><span id="tasks-count" class="badge">0</span></div>
    <div id="tasks-list"></div>
  </aside>
</main>

<footer>Esta versi√≥n no usa fetch ni m√≥dulos. Ideal para abrir con doble clic.</footer>

<!-- Datos embebidos -->
<script id="data-projects" type="application/json">[
  {"id":"p-1","name":"Implementaci√≥n ERP","company":"Industrias Nova","budget":180000,"objective":"Centralizar procesos y unificar cat√°logo maestro.","documentation":"https://docs.example.com/erp","leadId":"m-1","start":"2025-09-15","end":"2025-12-20"},
  {"id":"p-2","name":"Portal Interno SOPs","company":"Scio-Automation","budget":35000,"objective":"Crear y publicar el portal de manuales y SOPs.","documentation":"https://docs.example.com/sops","leadId":"m-2","start":"2025-09-10","end":"2025-10-31"}
]</script>
<script id="data-team" type="application/json">[
  {"id":"m-1","name":"David Cort√©s","email":"david@example.com","role":"Project Manager"},
  {"id":"m-2","name":"Kayla Johnson","email":"kayla@example.com","role":"Tech Lead"},
  {"id":"m-3","name":"Marco L√≥pez","email":"marco@example.com","role":"Backend Dev"},
  {"id":"m-4","name":"Mounika I.","email":"mounika@example.com","role":"Frontend Dev"}
]</script>
<script id="data-tasks" type="application/json">[
  {"id":"t-1","projectId":"p-1","assigneeId":"m-3","name":"Modelo de datos ERP","start":"2025-09-16T09:00:00","end":"2025-09-16T13:00:00","progress":60,"status":"En curso"},
  {"id":"t-2","projectId":"p-1","assigneeId":"m-1","name":"Revisi√≥n con Compras","start":"2025-09-17T10:00:00","end":"2025-09-17T12:00:00","progress":20,"status":"Pendiente"},
  {"id":"t-3","projectId":"p-2","assigneeId":"m-4","name":"UI de Portal SOPs","start":"2025-09-18T09:00:00","end":"2025-09-18T17:00:00","progress":45,"status":"En curso"},
  {"id":"t-4","projectId":"p-2","assigneeId":"m-2","name":"Autenticaci√≥n y roles","start":"2025-09-19T09:00:00","end":"2025-09-19T15:00:00","progress":10,"status":"Planificada"}
]</script>
<script id="data-meetings" type="application/json">[
  {"id":"meet-1","projectId":"p-1","relatedTaskId":"t-1","title":"Kickoff ERP","url":"https://meet.example.com/abc123","attendees":["m-1","m-2","m-3"],"start":"2025-09-16T15:00:00","end":"2025-09-16T16:00:00","reason":"Alinear objetivos y entregables"},
  {"id":"meet-2","projectId":"p-2","relatedTaskId":"t-3","title":"Dise√±o de componentes","url":"https://meet.example.com/xyz789","attendees":["m-2","m-4"],"start":"2025-09-18T11:00:00","end":"2025-09-18T12:00:00","reason":"Definir layout y tokens"}
]</script>

<!-- L√≥gica sin m√≥dulos -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script>
  const getData = (id) => JSON.parse(document.getElementById(id).textContent);
  const projects = getData('data-projects');
  const team     = getData('data-team');
  const tasks    = getData('data-tasks');
  const meetings = getData('data-meetings');

  const findProject = id => projects.find(p => p.id === id);
  const findMember  = id => team.find(m => m.id === id);
  const fmt = (d)=>{const x=new Date(d);const hasT=d.includes("T");return new Intl.DateTimeFormat('es-MX',{dateStyle:'medium', timeStyle:hasT?'short':undefined}).format(x)};

  function renderTasks(){
    const c = document.getElementById('tasks-list'); c.innerHTML='';
    tasks.forEach(t=>{
      const p=findProject(t.projectId), a=findMember(t.assigneeId);
      const el=document.createElement('article'); el.className='task-card';
      el.innerHTML=`
        <div class="task-title">
          <span>${t.name}</span><span class="badge">${t.status??'‚Äî'}</span>
        </div>
        <div class="task-meta">
          <span>üìÅ ${p?.name??'Proyecto'}</span>
          <span>üë§ ${a?.name??'Sin asignar'}</span>
          <span>üïí ${fmt(t.start)} - ${fmt(t.end)}</span>
        </div>
        <div class="progress-bar"><span style="width:${t.progress??0}%"></span></div>`;
      c.appendChild(el);
    });
    document.getElementById('tasks-count').textContent = `${tasks.length} tareas`;
  }

  function events(){
    const tEvents = tasks.map(t=>{
      const a=findMember(t.assigneeId), p=findProject(t.projectId);
      return { id:t.id, title:`${t.name} ‚Ä¢ ${a?.name??'Sin asignar'}`, start:t.start, end:t.end,
               backgroundColor:'#3b82f6', borderColor:'#1d4ed8',
               extendedProps:{type:'task', project:p?.name??'Proyecto', status:t.status}};
    });
    const mEvents = meetings.map(m=>{
      const p=findProject(m.projectId);
      return { id:m.id, title:`üìû ${m.title}`, start:m.start, end:m.end,
               backgroundColor:'#6366f1', borderColor:'#4338ca',
               extendedProps:{type:'meeting', project:p?.name??'Proyecto',
                              attendees:m.attendees.map(id=>findMember(id)?.name??'').join(', ')},
               url:m.url};
    });
    return [...tEvents, ...mEvents];
  }

  function renderCalendar(){
    const el=document.getElementById('calendar');
    const cal=new FullCalendar.Calendar(el,{
      initialView:'timeGridWeek',
      headerToolbar:{left:'prev,next today',center:'title',right:'dayGridMonth,timeGridWeek,listWeek'},
      locale:'es', height:'auto', slotMinTime:'07:00:00', slotMaxTime:'20:00:00',
      eventTimeFormat:{hour:'2-digit',minute:'2-digit',hour12:false},
      events: events(),
      eventClick: info=>{ if(info.event.url){ info.jsEvent.preventDefault(); window.open(info.event.url,'_blank'); } }
    });
    cal.render();
  }

  renderTasks(); renderCalendar();
</script>
</body>
</html>
